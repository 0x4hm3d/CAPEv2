
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Submit an Analysis &#8212; CAPE Sandbox v2.1 Book</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/classic.css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Web interface" href="web.html" />
    <link rel="prev" title="Starting CAPE" href="start.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="web.html" title="Web interface"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="start.html" title="Starting CAPE"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CAPE Sandbox v2.1 Book</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Usage</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Submit an Analysis</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="submit-an-analysis">
<h1>Submit an Analysis<a class="headerlink" href="#submit-an-analysis" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="#submitpy"><span class="std std-ref">Submission Utility</span></a></p></li>
<li><p><a class="reference internal" href="#apipy"><span class="std std-ref">API</span></a></p></li>
<li><p><a class="reference internal" href="#distpy"><span class="std std-ref">Distributed CAPE</span></a></p></li>
<li><p><a class="reference internal" href="#webpy"><span class="std std-ref">Web Interface</span></a></p></li>
<li><p><a class="reference internal" href="#python"><span class="std std-ref">Python Functions</span></a></p></li>
</ul>
</div></blockquote>
<section id="submission-utility">
<span id="submitpy"></span><h2>Submission Utility<a class="headerlink" href="#submission-utility" title="Permalink to this headline">¶</a></h2>
<p>The easiest way to submit an analysis is to use the provided <em>submit.py</em>
command-line utility. It currently has the following options available:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">submit</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">remote</span> <span class="n">REMOTE</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">url</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">package</span> <span class="n">PACKAGE</span><span class="p">]</span>
                 <span class="p">[</span><span class="o">--</span><span class="n">custom</span> <span class="n">CUSTOM</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">timeout</span> <span class="n">TIMEOUT</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">options</span> <span class="n">OPTIONS</span><span class="p">]</span>
                 <span class="p">[</span><span class="o">--</span><span class="n">priority</span> <span class="n">PRIORITY</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">machine</span> <span class="n">MACHINE</span><span class="p">]</span>
                 <span class="p">[</span><span class="o">--</span><span class="n">platform</span> <span class="n">PLATFORM</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">memory</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">enforce</span><span class="o">-</span><span class="n">timeout</span><span class="p">]</span>
                 <span class="p">[</span><span class="o">--</span><span class="n">clock</span> <span class="n">CLOCK</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">tags</span> <span class="n">TAGS</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="nb">max</span> <span class="n">MAX</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">pattern</span> <span class="n">PATTERN</span><span class="p">]</span>
                 <span class="p">[</span><span class="o">--</span><span class="n">shuffle</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">unique</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">quiet</span><span class="p">]</span>
                 <span class="n">target</span>

<span class="n">positional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="n">target</span>               <span class="n">URL</span><span class="p">,</span> <span class="n">path</span> <span class="n">to</span> <span class="n">the</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">folder</span> <span class="n">to</span> <span class="n">analyze</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>           <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
  <span class="o">--</span><span class="n">remote</span> <span class="n">REMOTE</span>      <span class="n">Specify</span> <span class="n">IP</span><span class="p">:</span><span class="n">port</span> <span class="n">to</span> <span class="n">a</span> <span class="n">CAPE</span> <span class="n">API</span> <span class="n">server</span> <span class="n">to</span> <span class="n">submit</span>
                       <span class="n">remotely</span>
  <span class="o">--</span><span class="n">url</span>                <span class="n">Specify</span> <span class="n">whether</span> <span class="n">the</span> <span class="n">target</span> <span class="ow">is</span> <span class="n">an</span> <span class="n">URL</span>
  <span class="o">--</span><span class="n">package</span> <span class="n">PACKAGE</span>    <span class="n">Specify</span> <span class="n">an</span> <span class="n">analysis</span> <span class="n">package</span>
  <span class="o">--</span><span class="n">custom</span> <span class="n">CUSTOM</span>      <span class="n">Specify</span> <span class="nb">any</span> <span class="n">custom</span> <span class="n">value</span>
  <span class="o">--</span><span class="n">timeout</span> <span class="n">TIMEOUT</span>    <span class="n">Specify</span> <span class="n">an</span> <span class="n">analysis</span> <span class="n">timeout</span>
  <span class="o">--</span><span class="n">options</span> <span class="n">OPTIONS</span>    <span class="n">Specify</span> <span class="n">options</span> <span class="k">for</span> <span class="n">the</span> <span class="n">analysis</span> <span class="n">package</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span>
                       <span class="s2">&quot;name=value,name2=value2&quot;</span><span class="p">)</span>
  <span class="o">--</span><span class="n">priority</span> <span class="n">PRIORITY</span>  <span class="n">Specify</span> <span class="n">a</span> <span class="n">priority</span> <span class="k">for</span> <span class="n">the</span> <span class="n">analysis</span> <span class="n">represented</span> <span class="n">by</span> <span class="n">an</span>
                       <span class="n">integer</span>
  <span class="o">--</span><span class="n">machine</span> <span class="n">MACHINE</span>    <span class="n">Specify</span> <span class="n">the</span> <span class="n">identifier</span> <span class="n">of</span> <span class="n">a</span> <span class="n">machine</span> <span class="n">you</span> <span class="n">want</span> <span class="n">to</span> <span class="n">use</span>
  <span class="o">--</span><span class="n">platform</span> <span class="n">PLATFORM</span>  <span class="n">Specify</span> <span class="n">the</span> <span class="n">operating</span> <span class="n">system</span> <span class="n">platform</span> <span class="n">you</span> <span class="n">want</span> <span class="n">to</span> <span class="n">use</span>
                       <span class="p">(</span><span class="n">windows</span><span class="o">/</span><span class="n">darwin</span><span class="o">/</span><span class="n">linux</span><span class="p">)</span>
  <span class="o">--</span><span class="n">memory</span>             <span class="n">Enable</span> <span class="n">to</span> <span class="n">take</span> <span class="n">a</span> <span class="n">memory</span> <span class="n">dump</span> <span class="n">of</span> <span class="n">the</span> <span class="n">analysis</span> <span class="n">machine</span>
  <span class="o">--</span><span class="n">enforce</span><span class="o">-</span><span class="n">timeout</span>    <span class="n">Enable</span> <span class="n">to</span> <span class="n">force</span> <span class="n">the</span> <span class="n">analysis</span> <span class="n">to</span> <span class="n">run</span> <span class="k">for</span> <span class="n">the</span> <span class="n">full</span>
                       <span class="n">timeout</span> <span class="n">period</span>
  <span class="o">--</span><span class="n">clock</span> <span class="n">CLOCK</span>        <span class="n">Set</span> <span class="n">virtual</span> <span class="n">machine</span> <span class="n">clock</span>
  <span class="o">--</span><span class="n">tags</span> <span class="n">TAGS</span>          <span class="n">Specify</span> <span class="n">tags</span> <span class="n">identifier</span> <span class="n">of</span> <span class="n">a</span> <span class="n">machine</span> <span class="n">you</span> <span class="n">want</span> <span class="n">to</span> <span class="n">use</span>
  <span class="o">--</span><span class="nb">max</span> <span class="n">MAX</span>            <span class="n">Maximum</span> <span class="n">samples</span> <span class="n">to</span> <span class="n">add</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">row</span>
  <span class="o">--</span><span class="n">pattern</span> <span class="n">PATTERN</span>    <span class="n">Pattern</span> <span class="n">of</span> <span class="n">files</span> <span class="n">to</span> <span class="n">submit</span>
  <span class="o">--</span><span class="n">shuffle</span>            <span class="n">Shuffle</span> <span class="n">samples</span> <span class="n">before</span> <span class="n">submitting</span> <span class="n">them</span>
  <span class="o">--</span><span class="n">unique</span>             <span class="n">Only</span> <span class="n">submit</span> <span class="n">new</span> <span class="n">samples</span><span class="p">,</span> <span class="n">ignore</span> <span class="n">duplicates</span>
  <span class="o">--</span><span class="n">quiet</span>              <span class="n">Only</span> <span class="nb">print</span> <span class="n">text</span> <span class="n">on</span> <span class="n">failure</span>
</pre></div>
</div>
<p>If you specify a directory as the target path, all of the files contained within that directory will be
submitted for analysis.</p>
<p>The concept of analysis packages will be dealt with later in this documentation (at
<a class="reference internal" href="packages.html"><span class="doc">Analysis Packages</span></a>). The following are some examples of how to use the <cite>submit.py</cite> tool:</p>
<blockquote>
<div><div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Remember to use the <code class="docutils literal notranslate"><span class="pre">cape</span></code> user. The following commands are executed as <code class="docutils literal notranslate"><span class="pre">cape</span></code>.</p>
</div>
</div></blockquote>
<p><em>Example</em>: Submit a local binary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./utils/submit.py /path/to/binary
</pre></div>
</div>
<p><em>Example</em>: Submit an URL:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./utils/submit.py --url http://www.example.com
</pre></div>
</div>
<p><em>Example</em>: Submit a local binary and specify a higher priority:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./utils/submit.py --priority 5 /path/to/binary
</pre></div>
</div>
<p><em>Example</em>: Submit a local binary and specify a custom analysis timeout of
60 seconds:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./utils/submit.py --timeout 60 /path/to/binary
</pre></div>
</div>
<p><em>Example</em>: Submit a local binary and specify a custom analysis package:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./utils/submit.py --package &lt;name of package&gt; /path/to/binary
</pre></div>
</div>
<p><em>Example</em>: Submit a local binary and specify a custom analysis package and
some options (in this case a command line argument for the malware):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./utils/submit.py --package exe --options arguments=--dosomething /path/to/binary.exe
</pre></div>
</div>
<p><em>Example</em>: Submit a local binary to be run on the virtual machine <em>cape1</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./utils/submit.py --machine cape1 /path/to/binary
</pre></div>
</div>
<p><em>Example</em>: Submit a local binary to be run on a Windows machine:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./utils/submit.py --platform windows /path/to/binary
</pre></div>
</div>
<p><em>Example</em>: Submit a local binary and take a full memory dump of the analysis machine once the analysis is complete:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./utils/submit.py --memory /path/to/binary
</pre></div>
</div>
<p><em>Example</em>: Submit a local binary and force the analysis to be executed for the full timeout (disregarding the internal mechanism that CAPE uses to decide when to terminate the analysis):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./utils/submit.py --enforce-timeout /path/to/binary
</pre></div>
</div>
<p><em>Example</em>: Submit a local binary and set the virtual machine clock. The format is %m-%d-%Y %H:%M:%S. If not specified, the current time is used. For example, if we want to run a sample on January 24th, 2001, at 14:41:20:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./utils/submit.py --clock &quot;01-24-2001 14:41:20&quot; /path/to/binary
</pre></div>
</div>
<p><em>Example</em>: Submit a sample for Volatility analysis (to reduce side effects of the CAPE hooking, switch it off with <em>options free=True</em>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./utils/submit.py --memory --options free=True /path/to/binary
</pre></div>
</div>
<section id="options-options-available">
<h3><code class="docutils literal notranslate"><span class="pre">--options</span></code> Options Available<a class="headerlink" href="#options-options-available" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">filename</span></code>: Rename the sample file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: This will force family extractor to run, Ex: name=trickbot</p></li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">curdir</span></code>: Change from where execute sample, by default %TEMP%, Ex: curdir=%APPDATA% or</dt><dd><p>curdir=%APPDATA%MicrosoftWindowsStart MenuProgramsStartup</p>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">executiondir</span></code>: Sets directory to launch the file from. Need not be the same as the directory of sample file. Defaults to %TEMP% if both executiondir and curdir are not specified. Only supports full paths</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">free</span></code>: Run without monitoring (disables many capabilities) Ex: free=1</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">force-sleepskip</span></code>: Override default sleep skipping behavior:  0 disables all sleep skipping, 1 skips all sleeps.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">full-logs</span></code>: By default, logs prior to network activity for URL analyses and prior to access of the file in question for non-executable formats are suppressed.  Set to 1 to disable log suppression.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">force-flush</span></code>: For performance reasons, logs are buffered before being sent back to the result server.  We make every attempt to flush the buffer at critical points including when exceptions occur, but in some rare termination scenarios, logs may be lost.  Set to 1 to force flushing of the log buffers after any non-duplicate API is called, set to 2 to force flushing of every log.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">no-stealth</span></code>: Set to 1 to disable anti-anti-VM/sandbox code enabled by default.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">buffer-max</span></code>: When set to an integer of your choice, changes the maximum number of bytes that can be logged for most API buffers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">large-buffer-max</span></code>: Some hooked APIs permit larger buffers to be logged.  To change the limit for this, set this to an integer of your choice.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">norefer</span></code>: Disables use of a fake referrer when performing URL analyses</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">file</span></code>: When using the zip or rar package, set the name of the file to execute</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">password</span></code>: When using the zip or rar package, set the password to use for extraction.  Also used when analyzing password-protected Office documents.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">function</span></code>: When using the dll package, set the name of the exported function to execute</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dllloader</span></code>: When using the dll package, set the name of the process loading the DLL (defaults to rundll32.exe).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">arguments</span></code>: When using the dll, exe, or python packages, set the arguments to be passed to the executable or exported function.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">appdata</span></code>: When using the exe package, set to 1 to run the executable out of the Application Data path instead of the Temp directory.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">startbrowser</span></code>: Setting this option to 1 will launch a browser 30 seconds into the analysis (useful for some banking trojans).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">browserdelay</span></code>: Sets the number of seconds to wait before starting the browser with the startbrowser option.  Defaults to 30 seconds.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">url</span></code>: When used with the startbrowser option, this will determine the URL the started browser will access.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">debug</span></code>: Set to 1 to enable reporting of critical exceptions occurring during analysis, set to 2 to enable reporting of all exceptions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">disable_hook_content</span></code>: Set to 1 to remove functionality of all hooks except those critical for monitoring other processes.  Set to 2 to apply to all hooks.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hook-type</span></code>: Valid for 32-bit analyses only.  Specifies the hook type to use: direct, indirect, or safe.  Safe attempts a Detours-style hook.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">serial</span></code>: Spoof the serial of the system volume as the provided hex value</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">single-process</span></code>: When set to 1 this will limit behaviour monitoring to the initial process only.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">exclude-apis</span></code>: Exclude the colon-separated list of APIs from being hooked</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">exclude-dlls</span></code>: Exclude the colon-separated list of DLLs from being hooked</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dropped-limit</span></code>: Override the default dropped file limit of 100 files</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">compression</span></code>: When set to 1 this will enable CAPE’s extraction of compressed payloads</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">extraction</span></code>: When set to 1 this will enable CAPE’s extraction of payloads from within each process</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">injection</span></code>: When set to 1 this will enable CAPE’s capture of injected payloads between processes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">combo</span></code>: This combines compression, injection and extraction with process dumps</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dump-on-api</span></code>: Dump the calling module when a function from the colon-separated list of APIs is used</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bp0</span></code>: Sets breakpoint 0 (processor/hardware) to a VA or RVA value (or module::export). Applies also to bp1-bp3.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">file-offsets</span></code>: Breakpoints in bp0-bp3 will be interpreted as PE file offsets rather than RVAs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">break-on-return</span></code>: Sets breakpoints on the return address(es) from a colon-separated list of APIs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">base-on-api</span></code>: Sets the base address to which breakpoints will be applied (and sets breakpoints)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">depth</span></code>: Sets the depth an instruction trace will step into (defaults to 0, requires Trace package)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">count</span></code>: Sets the number of instructions in a trace (defaults to 128, requires Trace package)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">referrer</span></code>: Specify the referrer to be used for URL tasks, overriding the default Google referrer</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">loop_detection</span></code>: Set this option to 1 to enable loop detection (compress call logs - behavior analysis)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">static</span></code>: Check if config can be extracted statically, if not, send to vm</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Dl&amp;Exec</span> <span class="pre">add</span> <span class="pre">headers</span></code>: Example: dnl_user_agent: “CAPE Sandbox”, dnl_referer: google</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">servicedesc</span></code> - for service package: Service description</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">arguments</span></code> - for service package: Service arguments</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">store_memdump</span></code>: Will force STORE memdump, only when submitting to analyzer node directly, as distributed cluster can modify this</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pre_script_args</span></code>: Command line arguments for pre_script. Example: pre_script_args=file1 file2 file3</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pre_script_timeout</span></code>: pre_script_timeout will default to 60 seconds. Script will stop after timeout Example: pre_script_timeout=30</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">during_script_args</span></code>: Command line arguments for during_script. Example: during_script_args=file1 file2 file3</p></li>
</ul>
</section>
</section>
<section id="web-interface">
<span id="webpy"></span><h2>Web Interface<a class="headerlink" href="#web-interface" title="Permalink to this headline">¶</a></h2>
<p>Detailed usage of the web interface is described in <a class="reference internal" href="web.html"><span class="doc">Web interface</span></a>.</p>
</section>
<section id="api">
<span id="apipy"></span><h2>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h2>
<p>Detailed usage of the REST API interface is described in <a class="reference internal" href="api.html"><span class="doc">REST API</span></a>.</p>
</section>
<section id="distributed-cape">
<span id="distpy"></span><h2>Distributed CAPE<a class="headerlink" href="#distributed-cape" title="Permalink to this headline">¶</a></h2>
<p>Detailed usage of the Distributed CAPE API interface is described in
<a class="reference internal" href="dist.html"><span class="doc">Distributed CAPE</span></a>.</p>
</section>
<section id="python-functions">
<span id="python"></span><h2>Python Functions<a class="headerlink" href="#python-functions" title="Permalink to this headline">¶</a></h2>
<p>To keep track of submissions, samples, and overall execution, CAPE
uses a popular Python ORM called <a class="reference external" href="http://www.sqlalchemy.org">SQLAlchemy</a> that allows you to make the sandbox
use PostgreSQL, SQLite, MySQL, and several other SQL database systems.</p>
<p>CAPE is designed to be easily integrated into larger solutions and to be fully
automated. To automate analysis submission we suggest using the REST
API interface described in <a class="reference internal" href="api.html"><span class="doc">REST API</span></a>, but in case you want to write a
Python submission script, you can also use the <code class="docutils literal notranslate"><span class="pre">add_path()</span></code> and <code class="docutils literal notranslate"><span class="pre">add_url()</span></code> functions.</p>
<dl class="py function">
<dt class="sig sig-object py" id="add_path">
<span class="sig-name descname"><span class="pre">add_path</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_path</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">timeout=0</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">package=None</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">options=None</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">priority=1</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">custom=None</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">machine=None</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">platform=None</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">memory=False</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">enforce_timeout=False</span></span></em><span class="optional">]</span>, <em class="sig-param"><span class="n"><span class="pre">clock=None[]</span></span></em><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#add_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a local file to the list of pending analysis tasks. Returns the ID of the newly generated task.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_path</strong> (<em>string</em>) – path to the file to submit</p></li>
<li><p><strong>timeout</strong> (<em>integer</em>) – maximum amount of seconds to run the analysis for</p></li>
<li><p><strong>package</strong> (<em>string</em><em> or </em><em>None</em>) – analysis package you want to use for the specified file</p></li>
<li><p><strong>options</strong> (<em>string</em><em> or </em><em>None</em>) – list of options to be passed to the analysis package (in the format <code class="docutils literal notranslate"><span class="pre">key=value,key=value</span></code>)</p></li>
<li><p><strong>priority</strong> (<em>integer</em>) – numeric representation of the priority to assign to the specified file (1 being low, 2 medium, 3 high)</p></li>
<li><p><strong>custom</strong> (<em>string</em><em> or </em><em>None</em>) – custom value to be passed over and possibly reused at processing or reporting</p></li>
<li><p><strong>machine</strong> (<em>string</em><em> or </em><em>None</em>) – CAPE identifier of the virtual machine you want to use, if none is specified one will be selected automatically</p></li>
<li><p><strong>platform</strong> (<em>string</em><em> or </em><em>None</em>) – operating system platform you want to run the analysis one (currently only Windows)</p></li>
<li><p><strong>memory</strong> (<em>True</em><em> or </em><em>False</em>) – set to <code class="docutils literal notranslate"><span class="pre">True</span></code> to generate a full memory dump of the analysis machine</p></li>
<li><p><strong>enforce_timeout</strong> (<em>True</em><em> or </em><em>False</em>) – set to <code class="docutils literal notranslate"><span class="pre">True</span></code> to force the execution for the full timeout</p></li>
<li><p><strong>clock</strong> (<em>string</em><em> or </em><em>None</em>) – provide a custom clock time to set in the analysis machine</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>integer</p>
</dd>
</dl>
<p>Example usage:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">lib.cuckoo.core.database</span> <span class="kn">import</span> <span class="n">Database</span>
<span class="linenos">2</span><span class="gp">&gt;&gt;&gt; </span><span class="n">db</span> <span class="o">=</span> <span class="n">Database</span><span class="p">()</span>
<span class="linenos">3</span><span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">add_path</span><span class="p">(</span><span class="s2">&quot;/tmp/malware.exe&quot;</span><span class="p">)</span>
<span class="linenos">4</span><span class="go">1</span>
<span class="linenos">5</span><span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="add_url">
<span class="sig-name descname"><span class="pre">add_url</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">url</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">timeout=0</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">package=None</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">options=None</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">priority=1</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">custom=None</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">machine=None</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">platform=None</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">memory=False</span></span></em><span class="optional">[</span>, <em class="sig-param"><span class="n"><span class="pre">enforce_timeout=False</span></span></em><span class="optional">]</span>, <em class="sig-param"><span class="n"><span class="pre">clock=None[]</span></span></em><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#add_url" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a local file to the list of pending analysis tasks. Returns the ID of the newly generated task.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>url</strong> (<em>string</em>) – URL to analyze</p></li>
<li><p><strong>timeout</strong> (<em>integer</em>) – maximum amount of seconds to run the analysis for</p></li>
<li><p><strong>package</strong> (<em>string</em><em> or </em><em>None</em>) – analysis package you want to use for the specified URL</p></li>
<li><p><strong>options</strong> (<em>string</em><em> or </em><em>None</em>) – list of options to be passed to the analysis package (in the format <code class="docutils literal notranslate"><span class="pre">key=value,key=value</span></code>)</p></li>
<li><p><strong>priority</strong> (<em>integer</em>) – numeric representation of the priority to assign to the specified URL (1 being low, 2 medium, 3 high)</p></li>
<li><p><strong>custom</strong> (<em>string</em><em> or </em><em>None</em>) – custom value to be passed over and possibly reused at processing or reporting</p></li>
<li><p><strong>machine</strong> (<em>string</em><em> or </em><em>None</em>) – CAPE identifier of the virtual machine you want to use, if none is specified one will be selected automatically</p></li>
<li><p><strong>platform</strong> (<em>string</em><em> or </em><em>None</em>) – operating system platform you want to run the analysis one (currently only Windows)</p></li>
<li><p><strong>memory</strong> (<em>True</em><em> or </em><em>False</em>) – set to <code class="docutils literal notranslate"><span class="pre">True</span></code> to generate a full memory dump of the analysis machine</p></li>
<li><p><strong>enforce_timeout</strong> (<em>True</em><em> or </em><em>False</em>) – set to <code class="docutils literal notranslate"><span class="pre">True</span></code> to force the execution for the full timeout</p></li>
<li><p><strong>clock</strong> (<em>string</em><em> or </em><em>None</em>) – provide a custom clock time to set in the analysis machine</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>integer</p>
</dd>
</dl>
</dd></dl>

<p>Example Usage:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">lib.cuckoo.core.database</span> <span class="kn">import</span> <span class="n">Database</span>
<span class="linenos">2</span><span class="gp">&gt;&gt;&gt; </span><span class="n">db</span> <span class="o">=</span> <span class="n">Database</span><span class="p">()</span>
<span class="linenos">3</span><span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">add_url</span><span class="p">(</span><span class="s2">&quot;http://www.cuckoosandbox.org&quot;</span><span class="p">)</span>
<span class="linenos">4</span><span class="go">2</span>
<span class="linenos">5</span><span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h2>
<section id="submit-py">
<h3>submit.py<a class="headerlink" href="#submit-py" title="Permalink to this headline">¶</a></h3>
<p>If you try to submit an analysis using <code class="docutils literal notranslate"><span class="pre">submit.py</span></code> and your output looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo -u cape poetry run python3 submit.py /path/to/binary/test.exe
Error: adding task to database
</pre></div>
</div>
<p>It could be due to errors while trying to communicate with the PostgreSQL instance. PostgreSQL is installed and configured by default when executing <code class="docutils literal notranslate"><span class="pre">cape2.sh</span></code>. Make sure your PostgreSQL instance is active and running. To check it out execute the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo systemctl status postgresql
</pre></div>
</div>
<p>If the status is other than <strong>Active</strong> (it can be in exited status, as long as it is Active), there is something that needs to be fixed.</p>
<p>The logs for PostgreSQL can be found under <em>/var/log/postgresql/*.log</em>.</p>
<p>If everything is working regarding PostgreSQL, <strong>make sure</strong> the <code class="docutils literal notranslate"><span class="pre">cape</span></code> user is able to access (both read and write) the directories involved in the analysis. For example, <code class="docutils literal notranslate"><span class="pre">cape</span></code> must be able to read and write in <em>/tmp</em>.</p>
</section>
</section>
<section id="analysis-results">
<h2>Analysis results<a class="headerlink" href="#analysis-results" title="Permalink to this headline">¶</a></h2>
<p>Check <a class="reference internal" href="results.html#analysis-results"><span class="std std-ref">Analysis Results</span></a>.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/cape.png" alt="Logo"/>
            </a></p>
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Submit an Analysis</a><ul>
<li><a class="reference internal" href="#submission-utility">Submission Utility</a><ul>
<li><a class="reference internal" href="#options-options-available"><code class="docutils literal notranslate"><span class="pre">--options</span></code> Options Available</a></li>
</ul>
</li>
<li><a class="reference internal" href="#web-interface">Web Interface</a></li>
<li><a class="reference internal" href="#api">API</a></li>
<li><a class="reference internal" href="#distributed-cape">Distributed CAPE</a></li>
<li><a class="reference internal" href="#python-functions">Python Functions</a></li>
<li><a class="reference internal" href="#troubleshooting">Troubleshooting</a><ul>
<li><a class="reference internal" href="#submit-py">submit.py</a></li>
</ul>
</li>
<li><a class="reference internal" href="#analysis-results">Analysis results</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="start.html"
                          title="previous chapter">Starting CAPE</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="web.html"
                          title="next chapter">Web interface</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/usage/submit.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="web.html" title="Web interface"
             >next</a></li>
        <li class="right" >
          <a href="start.html" title="Starting CAPE"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CAPE Sandbox v2.1 Book</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Usage</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Submit an Analysis</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2010-2015, Cuckoo Foundation, 2016-2020, kevoreilly.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.5.0.
    </div>
  </body>
</html>